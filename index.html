<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>STAMP TOUR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#317EFB" />
  <style>
    :root { color-scheme: dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin:0; padding:20px; text-align:center; background:#121212; color:#eee; }
    h1,h2 { margin:8px 0 16px; color:#fff; }
    .card { max-width:480px; margin:12px auto; padding:16px; border-radius:12px; background:#1e1e1e; box-shadow:0 4px 12px rgba(0,0,0,.5); }
    .row { display:flex; gap:8px; justify-content:center; align-items:center; flex-wrap:wrap; }
    input, select { padding:10px 12px; font-size:16px; border:1px solid #333; border-radius:8px; min-width:220px; background:#2a2a2a; color:#fff; }
    button { padding:10px 14px; font-size:15px; border:none; border-radius:10px; cursor:pointer; }
    .primary{ background:#317EFB; color:#fff; } .ghost{ background:transparent; border:1px solid #317EFB; color:#317EFB; }

    /* 도장판 */
    .stampboard { position:relative; width:100%; max-width:600px; aspect-ratio:3/2; margin:12px auto; border:2px solid #444; border-radius:12px; overflow:hidden; }
    .stampboard img { position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; pointer-events:none; }

    /* 부스 리스트 (JS로 렌더) */
    .booth-list { display:flex; flex-direction:column; gap:10px; max-width:420px; margin:14px auto; }
    .booth-row { display:flex; gap:8px; justify-content:center; }
    .booth-btn { background:#2a2a2a; color:#fff; border:1px solid #444; padding:12px; border-radius:10px; transition:background .2s; }
    .booth-btn:hover { background:#317EFB; color:#fff; }

    /* 상단바 / 뒤로 */
    .topbar { display:flex; justify-content:space-between; align-items:center; margin:0 auto 8px; padding:6px 12px; background:#2a2a2a; border-radius:8px; }
    .topbar .info { font-size:14px; opacity:.8; color:#ccc; }
    .back-btn { position:fixed; top:10px; left:10px; z-index:1000; background:#317EFB; color:#fff; border:none; padding:6px 12px; border-radius:6px; font-size:18px; font-weight:bold; }

    /* Staff 탭 */
    .tab-divider { border:none; border-top:2px solid #444; margin:8px 0; }
    .tab-bar { display:flex; justify-content:flex-start; gap:6px; margin-bottom:16px; }
    .tab-btn { background:#2a2a2a; border:none; color:#fff; padding:8px 14px; border-radius:8px; cursor:pointer; transition:all .2s; font-weight:500; }
    .tab-btn.active { background:#317EFB; color:#fff; }

    /* 예약 테이블 */
    table { width:100%; border-collapse:collapse; margin:10px 0; }
    th, td { border:1px solid #444; padding:8px; }
    th { background:#2a2a2a; }
    .hint { font-size:13px; color:#bbb; }
  </style>
</head>
<body>
  <h1>스탬프 투어</h1>

  <!-- 인증 -->
  <div id="auth-section" class="card">
    <h2>로그인 / 회원가입</h2>
    <div class="row" style="margin-bottom:8px;">
      <input type="text" id="nickname" placeholder="닉네임" />
      <input type="email" id="email" placeholder="이메일" />
      <input type="password" id="password" placeholder="비밀번호" />
    </div>
    <div class="row">
      <button id="signup" class="ghost">회원가입</button>
      <button id="login" class="primary">로그인</button>
    </div>
  </div>

  <!-- 앱 메인 -->
  <div id="app-section" class="card" style="display:none;">
    <div class="topbar">
      <div class="info" id="user-display"></div>
      <button id="logout" class="ghost">로그아웃</button>
    </div>

    <h2>내 도장판</h2>
    <div class="stampboard" id="stampBoard"></div>

    <h2>부스 선택</h2>
    <div id="booth-list" class="booth-list"><!-- JS가 렌더 --></div>

    <hr style="margin:20px 0; border:1px solid #444;" />
    <button class="booth-btn" onclick="openStaffLogin()">Staff Only</button>
  </div>

  <!-- 부스 소개 -->
  <div id="booth-section" class="card" style="display:none; position:relative;">
    <button class="back-btn" onclick="closeBooth()">«</button>
    <h2 id="booth-name"></h2>
    <img id="booth-img" alt="부스 소개 이미지" />
    <p id="booth-desc"></p>
  </div>

  <!-- 예약 페이지 -->
  <div id="reserve-section" class="card" style="display:none; position:relative;">
    <button class="back-btn" onclick="closeReserve()">«</button>
    <h2 id="reserve-title">예약</h2>

    <table>
      <thead><tr><th style="width:120px;">시간</th><th>닉네임</th></tr></thead>
      <tbody id="reserve-tbody"><tr><td colspan="2">불러오는 중…</td></tr></tbody>
    </table>

    <p class="hint">※ 동시간대 최대 <b id="reserve-capacity">2</b>명 예약 가능</p>

    <div class="row" style="gap:8px;">
      <select id="reserve-slot"></select>
      <button id="reserve-action" class="primary">예약</button>
    </div>
    <p id="reserve-msg" class="hint" style="margin-top:8px;"></p>
  </div>

  <!-- Staff 로그인 -->
  <div id="staff-login-section" class="card" style="display:none;">
    <button class="back-btn" onclick="closeStaffLogin()">«</button>
    <h2>관리자 로그인</h2>
    <input type="password" id="staff-password" placeholder="비밀번호 입력" />
    <div style="margin-top:10px;">
      <button class="primary" onclick="checkStaffPassword()">확인</button>
    </div>
  </div>

  <!-- Staff 관리 -->
  <div id="staff-section" class="card" style="display:none;">
    <button class="back-btn" onclick="closeStaff()">«</button>
    <h2 id="staff-booth-name">부스 관리</h2>

    <hr class="tab-divider" />
    <div class="tab-bar">
      <button class="tab-btn active" onclick="openStaffTab('stamp')">도장</button>
      <button class="tab-btn" onclick="openStaffTab('reserve')">예약</button>
    </div>
    <hr class="tab-divider" />

    <!-- 도장 탭 -->
    <div id="staff-tab-stamp" style="display:block;">
      <div class="row" style="gap:6px;">
        <input type="text" id="target-nickname" placeholder="닉네임 입력" />
        <button class="primary" onclick="giveStamp()">도장 찍기</button>
      </div>
      <p id="stamp-result" class="hint" style="margin-top:10px;"></p>
    </div>

    <!-- 예약 탭 -->
    <div id="staff-tab-reserve" style="display:none;">
      <label style="display:flex; align-items:center; gap:8px; justify-content:center;">
        <input type="checkbox" id="reserve-toggle" />
        <span>이 부스 예약 기능 사용</span>
      </label>
      <p class="hint" style="margin-top:6px;">켜면 홈의 해당 부스에 <b>예약</b> 버튼이 보입니다.</p>
      <p id="reserve-toggle-msg" class="hint"></p>
    </div>
  </div>

  <script type="module" src="app.js"></script>
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./service-worker.js").catch(console.error);
    }
  </script>
</body>
</html>
