<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>DSHS Stamp Tour</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="theme-color" content="#317EFB">

  <link rel="manifest" href="manifest.json?v=2025-11-11">

  <style>
    :root { color-scheme: dark; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      margin:0; padding:20px; text-align:center;
      background:#121212; color:#eee;
    }
    h1,h2 { margin:6px 0 12px; }

    .card {
      max-width:480px; margin:12px auto; padding:16px;
      background:#1e1e1e; border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,0.4);
    }

    input, select {
      padding:10px; background:#2a2a2a; color:#fff;
      border:1px solid #333; border-radius:8px; min-width:200px;
    }
    button {
      padding:10px 14px; font-size:15px; border:none; border-radius:10px;
      cursor:pointer;
    }

    .primary { background:#317EFB; color:#fff; }
    .ghost { background:transparent; border:1px solid #317EFB; color:#317EFB; }
    .danger { background:#b00020; color:#fff; }

    #stampBoard {
      position:relative; width:100%; max-width:600px;
      aspect-ratio:3/2; margin:12px auto;
      overflow:hidden; border-radius:12px;
      border:1px solid #444;
    }
    #stampBoard img { position:absolute; inset:0; width:100%; height:100%; object-fit:cover; }

    .booth-grid {
      display:flex; flex-direction:column; max-width:420px;
      margin:14px auto; gap:0;
    }
    .booth-row {
      display:flex; align-items:center;
      padding:8px 0; border-bottom:1px solid #444;
    }
    .booth-row:last-child { border-bottom:none; }
    .booth-btn {
      background:#2a2a2a; border:1px solid #444; color:#fff;
      padding:12px; border-radius:10px;
      margin-right:12px;
    }
    .booth-btn:hover { background:#317EFB; }

    .reserve-btn { margin-left:auto; }

    .back-btn {
      position:fixed; left:10px; top:10px;
      background:#317EFB; color:#fff;
      border:none; padding:6px 12px; border-radius:6px;
      font-size:18px; z-index:999;
    }

    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th,td { padding:6px; border:1px solid #444; font-size:14px; }
    th { background:#2a2a2a; }

    .settings-btn {
      position:fixed; right:14px; top:14px; width:44px; height:44px;
      background:#2a2a2a; border:1px solid #444; border-radius:50%;
      font-size:22px; color:#fff; cursor:pointer;
      display:none; align-items:center; justify-content:center;
    }
    .settings-btn:hover { background:#317EFB; }

    #booth-img {
      width:100%; max-width:360px;
      border-radius:12px;
      margin:10px auto;
      display:block;
    }
  </style>
</head>

<body>
<h1>DSHS Stamp Tour</h1>

<!-- 로그인 -->
<div id="login-section" class="card">
  <h2>로그인</h2>
  <input id="login-nickname" type="text" placeholder="닉네임 (최대 8자)">
  <br><br>
  <button id="login" class="primary">입장</button>
  <p style="font-size:13px; color:#aaa; margin-top:6px;">
    닉네임만 입력하면 자동으로 계정이 생성됩니다.
  </p>
</div>

<!-- 메인 -->
<div id="app-section" class="card" style="display:none;">
  <div style="display:flex; justify-content:space-between;">
    <div id="user-display" style="opacity:.8;"></div>
    <button id="logout" class="ghost">로그아웃</button>
  </div>

  <h2>내 도장판</h2>
  <div id="stampBoard"></div>

  <h2>부스 소개</h2>
  <div id="booth-list" class="booth-grid"></div>
  <hr>
  <button class="booth-btn" onclick="openStaffLogin()">Staff Only</button>
</div>

<!-- 부스 상세 -->
<div id="booth-section" class="card" style="display:none; position:relative;">
  <button class="back-btn" onclick="closeBooth()">«</button>
  <h2 id="booth-name"></h2>
  <img id="booth-img">
  <p id="booth-desc"></p>
</div>

<!-- 예약 -->
<div id="reserve-section" class="card" style="display:none;">
  <button class="back-btn" onclick="closeReserve()">«</button>
  <h2 id="reserve-title"></h2>

  <table>
    <thead><tr><th style="width:100px;">시간</th><th>닉네임</th></tr></thead>
    <tbody id="reserve-tbody"><tr><td colspan="2">불러오는 중…</td></tr></tbody>
  </table>

  <p>※ 동시간대 최대 <b id="reserve-capacity">2</b>명 예약 가능</p>

  <div style="display:flex; gap:8px; justify-content:center;">
    <select id="reserve-slot"></select>
    <button id="reserve-action" class="primary">예약</button>
  </div>
</div>

<!-- 스태프 로그인 -->
<div id="staff-login-section" class="card" style="display:none;">
  <button class="back-btn" onclick="closeStaffLogin()">«</button>
  <h2>관리자 로그인</h2>
  <input id="staff-password" type="password" placeholder="비밀번호">
  <br><br>
  <button class="primary" onclick="checkStaffPassword()">확인</button>
</div>

<!-- 스태프 -->
<div id="staff-section" class="card" style="display:none;">
  <button class="back-btn" onclick="closeStaff()">«</button>
  <h2 id="staff-booth-name"></h2>

  <div style="display:flex; gap:6px; margin-bottom:8px;">
    <button class="tab-btn active" onclick="openStaffTab('stamp')">도장</button>
    <button class="tab-btn" onclick="openStaffTab('reserve')">예약</button>
  </div>

  <!-- 도장 -->
  <div id="staff-tab-stamp" style="display:block;">
    <input id="target-nickname" type="text" placeholder="닉네임 입력">
    <button class="primary" onclick="giveStamp()">도장 찍기</button>
    <p id="stamp-result" style="margin-top:10px; font-size:14px;"></p>
  </div>

  <!-- 예약관리 -->
  <div id="staff-tab-reserve" style="display:none; text-align:left;">
    <label><input type="checkbox" id="reserve-toggle"> 예약 기능 사용</label>

    <div id="staff-reserve-admin" style="display:none; margin-top:10px;">
      <h3>시간당 최대 예약 인원</h3>
      <input id="capacity-input" type="number" min="1" style="width:80px;">
      <button class="primary" onclick="saveCapacity()">저장</button>

      <h3>예약 목록</h3>
      <table>
        <thead><tr><th>시간</th><th>닉네임</th><th>전화</th></tr></thead>
        <tbody id="staff-reserve-tbody"></tbody>
      </table>

      <h3>시간 추가</h3>
      <input id="add-hour" type="text" placeholder="예: 13:30" style="width:100px;">
      <button class="primary" onclick="addReserveTime()">추가</button>

      <h3>시간 삭제</h3>
      <select id="delete-time"></select>
      <button class="ghost" onclick="deleteReserveTime()">삭제</button>
    </div>
  </div>
</div>

<!-- 설정 버튼 -->
<button id="settings-btn" class="settings-btn">⚙️</button>

<!-- JS -->
<script type="module" src="app.js?v=2025-11-11-full"></script>

</body>
</html>
